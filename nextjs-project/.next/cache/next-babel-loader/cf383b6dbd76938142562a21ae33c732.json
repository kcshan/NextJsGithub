{"ast":null,"code":"\"use strict\";\n\n// 即在客户端执行 又在服务端执行\nconst axios = require('axios');\n\nconst github_base_url = 'https://api.github.com';\n\nconst requestGithub = async (method, url, data, headers) => {\n  return await axios({\n    method,\n    url: `${github_base_url}${url}`,\n    data,\n    headers\n  });\n};\n\nconst isServer = typeof window === 'undefined';\n\nconst request = async ({\n  method = 'GET',\n  url,\n  data = {}\n}, req, res) => {\n  if (!url) {\n    throw Error('url must provide');\n  }\n\n  if (isServer) {\n    const session = req.session;\n    const githubAuth = session.githubAuth || {};\n    const headers = {};\n\n    if (githubAuth.access_token) {\n      headers['Authorization'] = `${githubAuth.token_type} ${githubAuth.access_token}`;\n    }\n\n    return await requestGithub(method, url, data, headers);\n  } else {\n    // /github/search/respos\n    return await axios({\n      method,\n      url: `/github${url}`,\n      data\n    });\n  }\n};\n\nmodule.exports = {\n  request,\n  requestGithub\n};","map":{"version":3,"sources":["/Users/yangshasha/Downloads/workspace/coding/nodejs/NextJsGithub/nextjs-project/lib/api.js"],"names":["axios","require","github_base_url","requestGithub","method","url","data","headers","isServer","window","request","req","res","Error","session","githubAuth","access_token","token_type","module","exports"],"mappings":";;AAAA;AACA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,MAAMC,eAAe,GAAG,wBAAxB;;AAEA,MAAMC,aAAa,GAAG,OAAOC,MAAP,EAAeC,GAAf,EAAoBC,IAApB,EAA0BC,OAA1B,KAAsC;AAC1D,SAAO,MAAMP,KAAK,CAAC;AACjBI,IAAAA,MADiB;AAEjBC,IAAAA,GAAG,EAAG,GAAEH,eAAgB,GAAEG,GAAI,EAFb;AAGjBC,IAAAA,IAHiB;AAIjBC,IAAAA;AAJiB,GAAD,CAAlB;AAMD,CAPD;;AASA,MAAMC,QAAQ,GAAG,OAAOC,MAAP,KAAkB,WAAnC;;AACA,MAAMC,OAAO,GAAG,OAAO;AAAEN,EAAAA,MAAM,GAAG,KAAX;AAAkBC,EAAAA,GAAlB;AAAuBC,EAAAA,IAAI,GAAG;AAA9B,CAAP,EAA2CK,GAA3C,EAAgDC,GAAhD,KAAwD;AACtE,MAAI,CAACP,GAAL,EAAU;AACR,UAAMQ,KAAK,CAAC,kBAAD,CAAX;AACD;;AACD,MAAIL,QAAJ,EAAc;AACZ,UAAMM,OAAO,GAAGH,GAAG,CAACG,OAApB;AACA,UAAMC,UAAU,GAAGD,OAAO,CAACC,UAAR,IAAsB,EAAzC;AACA,UAAMR,OAAO,GAAG,EAAhB;;AAEA,QAAIQ,UAAU,CAACC,YAAf,EAA6B;AAC3BT,MAAAA,OAAO,CAAC,eAAD,CAAP,GAA4B,GAAEQ,UAAU,CAACE,UAAW,IAAGF,UAAU,CAACC,YAAa,EAA/E;AACD;;AACD,WAAO,MAAMb,aAAa,CAACC,MAAD,EAASC,GAAT,EAAcC,IAAd,EAAoBC,OAApB,CAA1B;AACD,GATD,MASO;AACL;AACA,WAAO,MAAMP,KAAK,CAAC;AACjBI,MAAAA,MADiB;AAEjBC,MAAAA,GAAG,EAAG,UAASA,GAAI,EAFF;AAGjBC,MAAAA;AAHiB,KAAD,CAAlB;AAKD;AACF,CArBD;;AAsBAY,MAAM,CAACC,OAAP,GAAiB;AACfT,EAAAA,OADe;AAEfP,EAAAA;AAFe,CAAjB","sourcesContent":["// 即在客户端执行 又在服务端执行\nconst axios = require('axios')\nconst github_base_url = 'https://api.github.com'\n\nconst requestGithub = async (method, url, data, headers) => {\n  return await axios({\n    method,\n    url: `${github_base_url}${url}`,\n    data,\n    headers\n  })\n}\n\nconst isServer = typeof window === 'undefined'\nconst request = async ({ method = 'GET', url, data = {} }, req, res) => {\n  if (!url) {\n    throw Error('url must provide')\n  }\n  if (isServer) {\n    const session = req.session\n    const githubAuth = session.githubAuth || {}\n    const headers = {}\n\n    if (githubAuth.access_token) {\n      headers['Authorization'] = `${githubAuth.token_type} ${githubAuth.access_token}`\n    }\n    return await requestGithub(method, url, data, headers)\n  } else {\n    // /github/search/respos\n    return await axios({\n      method,\n      url: `/github${url}`,\n      data\n    })\n  }\n}\nmodule.exports = {\n  request,\n  requestGithub\n}"]},"metadata":{},"sourceType":"script"}